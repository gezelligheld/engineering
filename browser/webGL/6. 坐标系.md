#### 坐标系分类

- 模型坐标系

一个物体通常由很多点构成，每个点在模型的什么位置需要用一个坐标系来参照，这个坐标系就叫模型坐标系，模型坐标系原点通常在模型的中心，各个坐标轴遵循右手坐标系，即 X 轴向右，Y 轴向上，Z 轴朝向屏幕外

- 世界坐标系

创建好的模型需要放置在世界中的各个位置，默认情况模型坐标系和世界坐标系重合，如果模型不在世界坐标系中心，那么就需要对模型坐标系进行转换。世界坐标系也是遵循右手坐标系

- 观察坐标系

人眼或者摄像机看到的世界中的物体相对于他自身的位置所参照的坐标系就叫观察坐标系或相机坐标系，通过改变观察位置可以看到整个 3D 空间的不同部分

- 裁剪坐标系

裁剪坐标是将相机坐标进行投影变换后得到的坐标，也就是 gl_Position 接收的坐标，遵循左手坐标系，即 X 轴向右，Y 轴向上，Z 轴朝向屏幕内。裁剪坐标系希望所有的坐标落在一个特点的范围内，不在范围内的坐标就被裁减掉不显示

将观察坐标变换为裁剪坐标的投影矩阵可以为两种不同的形式：正射投影矩阵创建一个立方体的裁剪空间，经过正射投影矩阵映射后的坐标 w 分量不会改变，始终是 1；透视投影矩阵会产生近大远小的效果，透视除法要求顶点坐标的每个分量除以它的 W 分量

- 设备（NDC） 坐标系

所有顶点被变换到裁剪空间，GPU 会对裁剪坐标执行透视除法，顶点坐标的 X，Y，Z 分量分别除以齐次 W 分量，将裁剪坐标系转为 NDC 坐标系，最终所有坐标分量的范围都会在【-1，1】之间，遵循左手坐标系

- 屏幕坐标系

GPU 会将 NDC 坐标映射到屏幕空间中

#### 坐标转换过程

webgl 中将模型渲染到屏幕上经历了以下过程

1. 顶点在模型坐标系中的坐标经过模型变换，转换到世界坐标系中，一般这两者是重合的

2. 然后通过摄像机观察这个世界，将物体从世界坐标系中转换到观察坐标系

3. 之后进行投影变换，将物体从观察坐标系中转换到裁剪坐标系

```c
gl_Position = vec4(x, y, z, 1);
```

4. GPU 接收裁剪坐标，通过透视除法，将裁剪坐标转换成 NDC 坐标

5. GPU 将 NDC 坐标通过视口变换，渲染到屏幕上

#### 坐标变换计算

- 模型坐标

以一个顶点 P 为例，该顶点在边长为 3 的正方体上，初始时顶点所在坐标系是模型坐标系，也就是相对于正方体中心位置，坐标为（3，3，0）

- 世界坐标

默认情况下世界坐标也是（3，3，0）。假设正方体中心移动到了（5，5，0）位置，那么世界坐标就变为（8，8，0）

- 观察坐标

有一个人在（3，3，0）处观察，那这个人所看到的世界处于观察坐标系中，相当于原点发生变化了，原来的世界坐标系原点在观察坐标系下是（-3，-3，0），那么顶点 P 的观察坐标变为（5，5，0）

- 裁剪坐标

指定一个正射投影观察箱，观察箱左侧坐标 -5，右侧坐标 5，上方坐标 5，下方坐标 -5，近平面坐标 0， 远平面坐标 5，那么 P 的裁剪坐标为（1，1，0，1），最后一位是 w 分量

- NDC 坐标

NDC 坐标是在 GPU 中 将裁剪坐标执行透视除法，w 为 1，NDC 坐标为（1，1，0，1）

- 屏幕坐标

视口设置如下，GPU 将 【-1，1】 的立方体范围内的坐标映射到宽 500，高 300 的屏幕坐标范围

```js
gl.viewport(0, 0, 500, 300);
```

NDC 坐标系长度为 2，那么一个单位对应的视口尺寸的一半，且屏幕坐标 y 轴方向向下，与 NDC 方向相反；原点在左上角，NDC 坐标系原点在屏幕坐标系中的坐标是（250，150），最后的屏幕坐标为（250 + 250，-150 + 250）=（500，0）

参考

1. [中级进阶 --- WebGL 坐标系](https://juejin.cn/book/6844733755580481543/section/6844733755937013773)

#### 子查询

select 语句中嵌套 select 语句称为子查询

- where 子句中的子查询，先执行子查询（括号内的部分）

```sql
select 字段名1 from 表名1 where ...(select 字段名2 from 表名2);
-- 示例，找出高于最低工资的员工
select ename,sal from emp where sal > (select min(sal) from emp);
```

- from 子句中的子查询，可以将子查询的结果当作一张临时表

```sql
select 字段名1 from (select 字段名2 from 表名);
-- 示例，找出每个岗位平均工资的薪资等级
-- 第一步，找出每个岗位平均工资
select job,avg(sal) from emp group by job;
-- 第二步，将上述查询结果看作一张临时表t，和薪资等级表做连接查询
select t.*, s.grade from t join salegrade s on t.sal between s.low and s.heigh;
-- 第三步，替换t
select t.*, s.grade from (select job,avg(sal) as avgsal from emp group by job) t join salegrade s on t.avgsal between s.low and s.heigh;
```

- select 子句中的子查询，要求子查询的查询结果只有一条，否则会报错

```sql
select 字段名1,(select 字段名2 from 表名2) from 表名1;
-- 示例，找出每个员工的部门名称
select ename,(select dname from dep d where e.depno = d.depno) from emp e;
```

#### 合并查询结果

合并查询时要求两个结果集列数相同，数据类型在 mysql 中不要求一致

```sql
select 字段名1 from 表名1 union select 字段名2 from 表名2;
-- 示例
select job from emp where job === 'manager' union select job from emp where job === 'saleman';
```

对于表连接而言，每连接一个新表匹配次数就要成倍的增加，使用合并查询可以减少匹配次数，效率更高（匹配次数从乘法变成了加法）

#### 去重（distinct）

借助关键字 distinct，distinct 只能出现在所有字段的前面

```sql
select distinct 字段名 from 表名;
-- 统计工作岗位数量
select count(distinct job) from emp;
```

多个字段联合去重

```sql
select distinct 字段名1,字段名2 from 表名;
```
